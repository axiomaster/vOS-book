# 从实模式到保护模式

## 实模式

**8086**是16位CPU，工作在实模式下。在实模式下，内存寻址时```[CS:IP]```通过如下运算得到指令地址：

```txt
物理地址 = CS左移4位 + IP
```

CS和IP均为16位寄存器，所以实模式下总的寻址范围为 $2^{20}=1Mb$。

## 保护模式

我们都知道Intel成功的很大一部分原因是向前兼容性做的很好。到了**80386**时代，CPU变成32位（段选择寄存器CS仍为16位）。为了更好的使用资源（更大的内存）及其它原因，```x86```的CPU新增了保护模式。同时为了兼容性，新CPU启动后默认运行在实模式下，通过一系列的设置（可以想象成打开一个开关），将CPU的运行状态从实模式切换到保护模式。

不管是**实模式**还是**保护模式**，都是和CPU硬件设计相关的，所有操作都是和硬件配合，受硬件约束的。

在保护模式下，内存寻址需要经过如下过程：

```txt
           分段               分页
逻辑地址 --------> 线性地址 --------> 物理地址
```

## 参考资料

- [我理解的逻辑地址、线性地址、物理地址和虚拟地址](http://bbs.chinaunix.net/thread-2083672-1-1.html)
- [Linux下逻辑地址、线性地址、物理地址详细总结](https://www.cnblogs.com/alantu2018/p/9002441.html)
